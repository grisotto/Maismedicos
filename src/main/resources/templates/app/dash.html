<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
      th:include="fragments/basetemplate :: page">
<head>
    <title>Paginal Inicial do Sistema de Questões</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>

<div th:fragment="content">

    <div class="col-lg-12">
        <h1 class="page-header">Dashboard</h1>

        Logged user: <span sec:authentication="name">Bob</span>
        Roles: <span sec:authentication="principal.authorities">[ALUNO, ADMIN, PROFESSOR, GRUPO]</span>
        <div sec:authorize="hasAuthority('ADMIN')">

            Essa mensagem só aparece para quem é admin

        </div>

        <div sec:authorize="hasAuthority('PROFESSOR')">
            Essa mensagem só aparece para quem é Professor
        </div>

        <div sec:authorize="hasAuthority('ALUNO')">
            Essa mensagem só aparece para quem é Aluno
        </div>

        <div sec:authorize="hasAuthority('GRUPO')">
            <div class="col-md-6">
                <h1>Equipe: <span th:text="${equipe.nome}"></span></h1>

                <h3>Titulo: <span th:text="${equipe.tarefa.titulo}"></span></h3>
                <h3>Descriçao: <span th:text="${equipe.tarefa.descricao}"></span></h3>


            </div>

            <div class="col-md-6">
                <h4>Alunos <span th:text="${equipe.alunos}"></span></h4>
                <table class="table table-responsive" id="Alunos">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Nome</th>

                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="e :${equipe.alunos}">

                        <td></td>
                        <td th:text="${e.nome}">1</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <br/>

            <!--<h4>EtapasAtual: <span th:text="${equipe.tarefa.etapaAtual}"></span></h4>-->
            <!--<h4>Etapas <span th:text="${equipe.tarefa.etapaEventos}"></span></h4>-->
            <table class="table table-responsive" id="EtapasTarefa">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Etapa</th>
                    <th>Data Incial</th>
                    <th>Data Final</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="e :${equipe.tarefa.etapaEventos}">
                    <td th:text="${e.tipo.id()}">1</td>
                    <td th:text="${e.tipo}">1</td>
                    <td th:text="${e.dataInicial}">1</td>
                    <!--<td th:text="${#dates.format(e.dataInicial, 'dd/MM/yyyy')}">1</td>-->
                    <td th:text="${e.dataFinal}">1</td>
                    <!--<td th:text="${#dates.format(e.dataFinal, 'dd/MM/yyyy')}">1</td>-->

                </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>
<div th:fragment="customCSS">

    <link href="/plugins/datatables-plugins/dataTables.bootstrap.css"
          th:href="@{/plugins/datatables-plugins/dataTables.bootstrap.css}"
          rel="stylesheet" media="screen"/>
    <link href="/plugins/datatables-responsive/dataTables.responsive.css"
          th:href="@{/plugins/datatables-responsive/dataTables.responsive.css}"
          rel="stylesheet" media="screen"/>
    <script src="/plugins/datatables/js/jquery.dataTables.min.js"
            th:src="@{/plugins/datatables/js/jquery.dataTables.min.js}"></script>
    <script src="/plugins/datatables-plugins/dataTables.bootstrap.min.js"
            th:src="@{/plugins/datatables-plugins/dataTables.bootstrap.min.js}"></script>
    <script src="/plugins/datatables-responsive/dataTables.responsive.js"
            th:src="@{/plugins/datatables-responsive/dataTables.responsive.js}"></script>


    <script src="/plugins/moment/min/moment-with-locales.js"
            th:src="@{/plugins/moment/min/moment-with-locales.js}"></script>
    <script
            src="/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"
            th:src="@{/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js}"></script>

    <link
            href="/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css"
            th:href="@{/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css}"
            rel="stylesheet" media="screen"/>


    <!--<script src="/plugins/select2/js/i18n/pt-BR.js"  th:src="@{/plugins/select2/js/i18n/pt-BR.js}"></script>-->


    <script type="text/javascript">
        $(document).ready(function () {
        });
        $('#EtapasTarefa').DataTable({
            responsive: true,
            "paging": false,
            "searching": false,

            "info": false,
            "order": [[2, "asc"]]

        });
        $('#Alunos').DataTable({
            responsive: true,
            "paging": false,
            "searching": false,

            "info": false,
            "order": [[1, "asc"]]

        });
    </script>

    <script type="text/javascript">
        $(function () {

            //Definindo o formato padrao e o locale
            $(
                '#datetimeAguardandoIni, #datetimeEsperandoSubmissaoIni, #datetimeValidandoQuestoesIni, #datetimeRespondendoQuestoesIni, #datetimeFinalizadoIni')
                .datetimepicker({
                    dayViewHeaderFormat: 'DD/MM/YYYY hh:mm',
                    locale: 'pt-br'
                });
            $(
                '#datetimeAguardandoFim, #datetimeEsperandoSubmissaoFim, #datetimeValidandoQuestoesFim, #datetimeRespondendoQuestoesFim, #datetimeFinalizadoFim')
                .datetimepicker({
                    dayViewHeaderFormat: 'DD/MM/YYYY hh:mm',
                    locale: 'pt-br',
                    useCurrent: false
                    //Important! See issue #1075
                });

            //Aqui eu olho para a data inicial e difinino uma data min para o Fim
            $("#datetimeAguardandoIni").on(
                "dp.change",
                function (e) {

                    $('#datetimeAguardandoFim').data("DateTimePicker")
                        .minDate(e.date);

                    // console.log(e.date);
                    //Pego a data e converto pegando os millisegundos
                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();
                    // console.log(outputDate);

                    //  console.log(Date.parse(outputDate));
                    //  console.log(outputDate.getTime());
                });

            $("#datetimeEsperandoSubmissaoIni").on(
                "dp.change",
                function (e) {

                    $('#datetimeEsperandoSubmissaoFim').data(
                        "DateTimePicker").minDate(e.date);

                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });

            $("#datetimeValidandoQuestoesIni").on(
                "dp.change",
                function (e) {

                    $('#datetimeValidandoQuestoesFim').data(
                        "DateTimePicker").minDate(e.date);

                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });

            $("#datetimeRespondendoQuestoesIni").on(
                "dp.change",
                function (e) {

                    $('#datetimeRespondendoQuestoesFim').data(
                        "DateTimePicker").minDate(e.date);

                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });

            $("#datetimeFinalizadoIni").on(
                "dp.change",
                function (e) {

                    $('#datetimeFinalizadoFim').data("DateTimePicker")
                        .minDate(e.date);

                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });

            //Aqui ao contrario da anterior
            $("#datetimeAguardandoFim").on(
                "dp.change",
                function (e) {
                    $('#datetimeAguardandoIni').data("DateTimePicker")
                        .maxDate(e.date);
                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });
            $("#datetimeEsperandoSubmissaoFim").on(
                "dp.change",
                function (e) {
                    $('#datetimeEsperandoSubmissaoIni').data(
                        "DateTimePicker").maxDate(e.date);
                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });

            $("#datetimeValidandoQuestoesFim").on(
                "dp.change",
                function (e) {
                    $('#datetimeValidandoQuestoesIni').data(
                        "DateTimePicker").maxDate(e.date);
                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });

            $("#datetimeRespondendoQuestoesFim").on(
                "dp.change",
                function (e) {
                    $('#datetimeRespondendoQuestoesIni').data(
                        "DateTimePicker").maxDate(e.date);
                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });

            $("#datetimeFinalizadoFim").on(
                "dp.change",
                function (e) {
                    $('#datetimeFinalizadoIni').data("DateTimePicker")
                        .maxDate(e.date);
                    var outputDate = new Date(e.date);
                    e.date = outputDate.getTime();

                });

        });
    </script>


</div>

</body>
</html>
